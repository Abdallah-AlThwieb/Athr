{% extends "base.html" %}
{% block title %}ูุงุฏู ุณุนุงุฏุชู{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-center">๐ ููุญุฉ ุชุญูู ุงููุดุฑู</h2>

  <!-- ุฅุถุงูุฉ ุณุคุงู -->
  <h4 class="text-primary mb-3">โ ุฅุถุงูุฉ ุณุคุงู:</h4>
  <form method="post" action="{{ url_for('admin.add_question') }}" class="mb-5 row g-2">
    <div class="col-md-6">
      <input name="question" placeholder="ูุต ุงูุณุคุงู" required class="form-control">
    </div>
    <div class="col-md-3">
      <input name="points" type="number" placeholder="ุงูููุงุท" required class="form-control">
    </div>
    <div class="col-md-12 mt-2">
      <label class="form-label">๐๏ธ ุงูุฃูุงู ุงูุชู ูุธูุฑ ูููุง ุงูุณุคุงู (ุงุชุฑููุง ูุงุฑุบุฉ ููุธูุฑ ูู ุงูุฃูุงู)</label>
      <div class="d-flex flex-wrap gap-2">
        {% set days = [
          (0, "ุงูุฅุซููู"), (1, "ุงูุซูุงุซุงุก"), (2, "ุงูุฃุฑุจุนุงุก"),
          (3, "ุงูุฎููุณ"), (4, "ุงูุฌูุนุฉ"), (5, "ุงูุณุจุช"), (6, "ุงูุฃุญุฏ")
        ] %}
        {% for num, name in days %}
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="visible_days" value="{{ num }}" id="day{{ num }}">
            <label class="form-check-label" for="day{{ num }}">{{ name }}</label>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-3 mt-3">
      <button type="submit" class="btn btn-success w-100">โ ุฅุถุงูุฉ</button>
    </div>
  </form>

  <!-- ุนุฑุถ ุงูุฃุณุฆูุฉ -->
  <h4 class="text-primary mb-3">๐ ุงูุฃุณุฆูุฉ ุงูุญุงููุฉ:</h4>
  <div class="mb-5">
    {% for q in questions %}
      <form method="post" action="{{ url_for('admin.edit_question', question_id=q.id) }}" class="question-box rounded p-3 mb-3 border border-light bg-light">
        <div class="row g-2 align-items-center">
          <div class="col-md-6">
            <input name="text" value="{{ q.text }}" class="form-control">
          </div>
          <div class="col-md-2">
            <input name="points" value="{{ q.points }}" class="form-control">
          </div>
          <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-outline-success btn-sm me-2">๐พ ุชุนุฏูู</button>
            <a href="{{ url_for('admin.delete_question', question_id=q.id) }}" class="btn btn-outline-danger btn-sm">๐๏ธ ุญุฐู</a>
          </div>
        </div>

        <div class="mt-2">
          <label class="form-label mb-1">๐๏ธ ุงูุฃูุงู ุงูุชู ูุธูุฑ ูููุง ุงูุณุคุงู:</label>
          <div class="d-flex flex-wrap gap-2">
            {% for num, name in days %}
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="visible_days" value="{{ num }}"
                       id="edit_day{{ q.id }}_{{ num }}"
                       {% if q.visible_days and num in q.visible_days %}checked{% endif %}>
                <label class="form-check-label" for="edit_day{{ q.id }}_{{ num }}">{{ name }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </form>
    {% endfor %}
  </div>

  <!-- ุฌุฏูู ุงูุทูุงุจ -->
  <h4 class="text-primary mb-3">๐ฅ ุงูุทูุงุจ ูููุงุทูู:</h4>
  <div class="table-responsive">
    <table class="table table-bordered table-striped text-center align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ุงูุงุณู</th>
          <th>ููุงุท ุงูููู</th>
          <th>ูุฌููุน ุงูููุงุท (ุงูุฃุณุฆูุฉ)</th>
          <th>ููุงุท ุฅุถุงููุฉ</th>
          <th class="text-success">ุงููุฌููุน ุงูููู</th>
          <th>ุชูุงุตูู</th>
        </tr>
      </thead>
      <tbody>
        {% for s in points_summary %}
          <tr>
            <td>{{ s.full_name }}</td>
            <td>{{ s.daily_points }}</td>
            <td>{{ s.total_points }}</td>
            <td>{{ s.manual_points }}</td>
            <td class="fw-bold text-success">{{ s.total_points + s.manual_points }}</td>
            <td>
              <a href="{{ url_for('admin.student_details', student_id=s.id) }}" class="btn btn-info btn-sm">
                ๐ ุนุฑุถ
              </a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ุฒุฑ ุนุฑุถ ุงูุชูุฑูุฑ -->
  <div class="text-center mt-5">
    <a href="{{ url_for('admin.report') }}" class="btn btn-primary btn-lg">
      ๐ ุนุฑุถ ุงูุชูุฑูุฑ ุงููุงูู
    </a>
  </div>
</div>
{% endblock %}
